<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>FXPay Cassino</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; margin: 20px }
    .card { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 12px }
    textarea { width: 100%; }
    button { margin-top: 6px; }
  </style>
</head>
<body>
  <h1>FXPay Cassino</h1>

  <div class="card">
    <input id="email" placeholder="Seu e-mail">
    <button onclick="login()">Entrar</button>
    <div id="user"></div>
  </div>

  <div class="card">
    <button onclick="wallet()">Atualizar carteira</button>
    <div id="wallet"></div>
  </div>

  <div class="card">
    <h3>Depósito</h3>
    <input id="depAmount" type="number" value="50" min="5">
    <button onclick="deposit()">Depositar</button>
    <div id="dep"></div>
  </div>

  <div class="card">
    <h3>Saque</h3>
    <input id="saqAmount" type="number" value="20">
    <select id="pixType">
      <option value="cpf">CPF</option>
      <option value="cnpj">CNPJ</option>
      <option value="email">E-mail</option>
      <option value="phone">Telefone</option>
      <option value="random">Chave Aleatória</option>
    </select>
    <input id="pixKey" placeholder="Informe a chave Pix">
    <button onclick="withdraw()">Sacar</button>
    <div id="saq"></div>
  </div>

  <div class="card">
    <h3>Roleta</h3>
    <input id="betAmount" type="number" value="5">
    <select id="betType">
      <option value="color">Cor</option>
      <option value="number">Número</option>
    </select>
    <input id="betValue" placeholder="red/black/green ou 0-36" value="red">
    <button onclick="bet()">Apostar</button>
    <div id="bet"></div>
  </div>

<script>
const API = ''; // coloque aqui a URL do backend no Render, ex: "https://seuapp.onrender.com"

let userId = null;

async function login() {
  const email = document.getElementById('email').value.trim();
  if (!email) return alert('Informe seu e-mail');

  const r = await fetch(`${API}/login`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email })
  });

  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro no login');

  userId = j.userId;
  document.getElementById('user').innerText = `User: ${j.email} (id: ${userId})`;
}

async function wallet() {
  if (!userId) return alert('Faça login');
  const r = await fetch(`${API}/wallet/${userId}`);
  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro ao buscar carteira');
  document.getElementById('wallet').innerText = `Saldo: R$ ${(j.balance/100).toFixed(2)} | Em processamento: R$ ${(j.hold/100).toFixed(2)}`;
}

async function deposit() {
  if (!userId) return alert('Faça login');
  const reais = Number(document.getElementById('depAmount').value);
  if (!reais || reais < 5) return alert('O valor mínimo para depósito é R$ 5,00');
  const amount = Math.floor(reais * 100); // centavos

  const r = await fetch(`${API}/deposit`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email: userId, amount, currency: 'BRL' })
  });

  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro no depósito');

  let html = `<p><b>Status:</b> ${j.status || 'pending'}</p>`;

  if (j.pixQrCode) {
    html += `<p><img src="${j.pixQrCode}" alt="QR Pix" style="max-width:200px"></p>`;
  }
  if (j.qr_code_base64) {
    html += `<p><img src="data:image/png;base64,${j.qr_code_base64}" alt="QR Pix" style="max-width:200px"></p>`;
  }
  if (j.pixCopiaCola) {
    html += `
      <p><b>Copia e Cola:</b></p>
      <textarea id="copiaCola" readonly style="width:100%;height:80px">${j.pixCopiaCola}</textarea>
      <button onclick="copyCopiaCola()">Copiar código</button>
    `;
  }
  if (j.checkoutUrl) {
    html += `<p><a href="${j.checkoutUrl}" target="_blank">Abrir checkout</a></p>`;
  }

  document.getElementById('dep').innerHTML = html;
}

function copyCopiaCola() {
  const textarea = document.getElementById('copiaCola');
  textarea.select();
  textarea.setSelectionRange(0, 99999);
  document.execCommand('copy');
  alert('Código Pix copiado!');
}

async function withdraw() {
  if (!userId) return alert('Faça login');
  const reais = Number(document.getElementById('saqAmount').value);
  const pixType = document.getElementById('pixType').value;
  const pixKey = document.getElementById('pixKey').value.trim();

  if (!reais || reais < 10) return alert('O valor mínimo para saque é R$ 10,00');
  if (!pixKey) return alert('Informe a chave Pix');

  const amount = Math.floor(reais * 100);

  const r = await fetch(`${API}/payout`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      email: userId,
      amount,
      currency: 'BRL',
      destination: { type: pixType, key: pixKey }
    })
  });

  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro no saque');
  document.getElementById('saq').innerText = `Payout: ${j.gateway_id || ''} (${j.status})`;
}

async function bet() {
  alert('A rota de aposta ainda não foi implementada no backend.');
}
</script>
</body>
</html>
