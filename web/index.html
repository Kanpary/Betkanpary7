<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>FXPay Cassino</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; margin: 20px }
    .card { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 12px }
    textarea { width: 100%; }
  </style>
</head>
<body>
  <h1>FXPay Cassino</h1>

  <div class="card">
    <input id="email" placeholder="Seu e-mail">
    <button onclick="login()">Entrar</button>
    <div id="user"></div>
  </div>

  <div class="card">
    <button onclick="wallet()">Atualizar carteira</button>
    <div id="wallet"></div>
  </div>

  <div class="card">
    <h3>Depósito</h3>
    <input id="depAmount" type="number" value="50" min="5">
    <button onclick="deposit()">Depositar</button>
    <div id="dep"></div>
  </div>

  <div class="card">
    <h3>Saque</h3>
    <input id="saqAmount" type="number" value="20">
    <input id="dest" placeholder="Destino (chave/conta)">
    <button onclick="withdraw()">Sacar</button>
    <div id="saq"></div>
  </div>

  <div class="card">
    <h3>Roleta</h3>
    <input id="betAmount" type="number" value="5">
    <select id="betType">
      <option value="color">Cor</option>
      <option value="number">Número</option>
    </select>
    <input id="betValue" placeholder="red/black/green ou 0-36" value="red">
    <button onclick="bet()">Apostar</button>
    <div id="bet"></div>
  </div>

<script>
const API = ''; // coloque aqui a URL do Render, ex: "https://seuapp.onrender.com"

let userId = null;

async function login() {
  const email = document.getElementById('email').value.trim();
  if (!email) return alert('Informe seu e-mail');

  const r = await fetch(`${API}/login`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email })
  });

  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro no login');

  userId = j.userId;
  document.getElementById('user').innerText = `User: ${j.email} (id: ${userId})`;
}

async function wallet() {
  if (!userId) return alert('Faça login');
  const r = await fetch(`${API}/wallet/${userId}`);
  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro ao buscar carteira');
  document.getElementById('wallet').innerText = `Saldo: R$ ${(j.balance/100).toFixed(2)} | Em processamento: R$ ${(j.hold/100).toFixed(2)}`;
}

async function deposit() {
  if (!userId) return alert('Faça login');
  const reais = Number(document.getElementById('depAmount').value);
  if (!reais || reais < 5) return alert('O valor mínimo para depósito é R$ 5,00');
  const amount = Math.floor(reais * 100); // centavos

  const r = await fetch(`${API}/deposit`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email: userId, amount, currency: 'BRL' })
  });

  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro no depósito');

  let html = `Status: ${j.status || 'pending'}`;
  if (j.pixQrCode) {
    html += `<br><img src="${j.pixQrCode}" alt="QR Pix" style="max-width:200px">`;
  }
  if (j.qr_code_base64) {
    html += `<br><img src="data:image/png;base64,${j.qr_code_base64}" alt="QR Pix" style="max-width:200px">`;
  }
  if (j.pixCopiaCola) {
    html += `<br><textarea readonly>${j.pixCopiaCola}</textarea>`;
  }
  if (j.checkoutUrl) {
    html += `<br><a href="${j.checkoutUrl}" target="_blank">Abrir checkout</a>`;
  }
  document.getElementById('dep').innerHTML = html;
}

async function withdraw() {
  if (!userId) return alert('Faça login');
  const reais = Number(document.getElementById('saqAmount').value);
  const destination = document.getElementById('dest').value.trim();
  if (!reais || reais <= 0) return alert('Informe um valor válido');
  if (!destination) return alert('Informe o destino');
  const amount = Math.floor(reais * 100);

  const r = await fetch(`${API}/payout`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email: userId, amount, destination, currency: 'BRL' })
  });

  const j = await r.json();
  if (!r.ok) return alert(j.error || 'Erro no saque');
  document.getElementById('saq').innerText = `Payout: ${j.gateway_id || ''} (${j.status})`;
}

async function bet() {
  alert('A rota de aposta ainda não foi implementada no backend.');
}
</script>
</body>
</html>
